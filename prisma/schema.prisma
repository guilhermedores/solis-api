generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["public", "tenant_demo"]
}

model Tenant {
  id           String    @id @default(uuid()) @db.Uuid
  subdomain    String    @unique @db.VarChar(100)
  companyName  String    @map("company_name") @db.VarChar(255)
  cnpj         String?   @unique @db.VarChar(18)
  active       Boolean   @default(true)
  plan         String    @default("basic") @db.VarChar(50)
  maxTerminals Int       @default(1) @map("max_terminals")
  maxUsers     Int       @default(5) @map("max_users")
  features     Json      @default("{}")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @default(now()) @updatedAt @map("updated_at")
  deletedAt    DateTime? @map("deleted_at")

  @@index([subdomain, active])
  @@index([active])
  @@map("tenants")
  @@schema("public")
}

model Usuario {
  id           String   @id @default(uuid()) @db.Uuid
  nome         String   @db.VarChar(255)
  email        String   @unique @db.VarChar(255)
  passwordHash String   @map("password_hash") @db.VarChar(255)
  role         String   @default("operator") @db.VarChar(50)
  ativo        Boolean  @default(true)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @default(now()) @updatedAt @map("updated_at")

  @@index([email])
  @@index([ativo])
  @@map("usuarios")
  @@schema("tenant_demo")
}

model Empresa {
  id                 String   @id @default(uuid())
  razaoSocial        String   @map("razao_social") @db.VarChar(255)
  nomeFantasia       String?  @map("nome_fantasia") @db.VarChar(255)
  cnpj               String   @db.VarChar(18)
  inscricaoEstadual  String?  @map("inscricao_estadual") @db.VarChar(20)
  inscricaoMunicipal String?  @map("inscricao_municipal") @db.VarChar(20)
  logradouro         String   @db.VarChar(255)
  numero             String   @db.VarChar(20)
  complemento        String?  @db.VarChar(100)
  bairro             String   @db.VarChar(100)
  cidade             String   @db.VarChar(100)
  uf                 String   @db.VarChar(2)
  cep                String   @db.VarChar(9)
  telefone           String?  @db.VarChar(20)
  email              String?  @db.VarChar(255)
  site               String?  @db.VarChar(255)
  regimeTributario   String   @map("regime_tributario") @db.VarChar(50)
  certificadoDigital String?  @map("certificado_digital")
  senhaCertificado   String?  @map("senha_certificado") @db.VarChar(255)
  ambienteFiscal     String   @default("homologacao") @map("ambiente_fiscal") @db.VarChar(20)
  logo               String?
  ativo              Boolean  @default(true)
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  @@index([cnpj])
  @@index([ativo])
  @@map("empresas")
  @@schema("tenant_demo")
}

model Produto {
  id            String         @id @default(uuid())
  codigoBarras  String?        @map("codigo_barras")
  codigoInterno String?        @map("codigo_interno")
  nome          String
  descricao     String?
  unidadeMedida String         @map("unidade_medida")
  categoria     String?
  ncm           String?
  cest          String?
  cfop          String?
  ativo         Boolean        @default(true)
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  precos        ProdutoPreco[]

  @@index([codigoBarras])
  @@index([codigoInterno])
  @@index([nome])
  @@map("produtos")
  @@schema("tenant_demo")
}

model ProdutoPreco {
  id         String   @id @default(uuid())
  produtoId  String   @map("produto_id")
  precoVenda Float    @map("preco_venda")
  precoCusto Float?   @map("preco_custo")
  ativo      Boolean  @default(true)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  produto    Produto  @relation(fields: [produtoId], references: [id], onDelete: Cascade)

  @@index([produtoId])
  @@map("produtos_precos")
  @@schema("tenant_demo")
}
